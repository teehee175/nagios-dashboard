# Nagios Dashboard - Apache (httpd) Configuration
# Copy this file to /etc/httpd/conf.d/nagios-dashboard.conf
# Then run: httpd -t && systemctl reload httpd
#
# This assumes the dashboard is running on the SAME server as Nagios.
# If Nagios is on a different server, adjust the ProxyPass URLs.

# Serve the dashboard on a separate port (or use a VirtualHost for port 80)
Listen 8080

<VirtualHost *:8080>
    ServerName localhost
    DocumentRoot /var/www/nagios-dashboard/dist

    # Dashboard static files
    <Directory /var/www/nagios-dashboard/dist>
        Options -Indexes +FollowSymLinks
        AllowOverride None
        Require all granted

        # SPA routing - rewrite all requests to index.html
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>

    # Cache static assets
    <LocationMatch "\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$">
        Header set Cache-Control "public, max-age=604800, immutable"
    </LocationMatch>

    # Proxy requests to Nagios CGI (same server)
    # Nagios is typically served via Apache on the same machine
    ProxyPreserveHost On
    ProxyPass /nagios/ http://127.0.0.1/nagios/
    ProxyPassReverse /nagios/ http://127.0.0.1/nagios/

    # If Nagios is on a DIFFERENT server, use:
    # ProxyPass /nagios/ http://nagios-server.example.com/nagios/
    # ProxyPassReverse /nagios/ http://nagios-server.example.com/nagios/

    # Timeout settings for slow Nagios responses
    ProxyTimeout 90

    # Security headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"

    # Logging
    ErrorLog /var/log/httpd/nagios-dashboard-error.log
    CustomLog /var/log/httpd/nagios-dashboard-access.log combined
</VirtualHost>

# Alternative: Serve dashboard at a path on existing port 80
# Uncomment below and comment out the VirtualHost above
#
# Alias /dashboard /var/www/nagios-dashboard/dist
# <Directory /var/www/nagios-dashboard/dist>
#     Options -Indexes +FollowSymLinks
#     AllowOverride None
#     Require all granted
#     RewriteEngine On
#     RewriteBase /dashboard
#     RewriteRule ^index\.html$ - [L]
#     RewriteCond %{REQUEST_FILENAME} !-f
#     RewriteCond %{REQUEST_FILENAME} !-d
#     RewriteRule . /dashboard/index.html [L]
# </Directory>
